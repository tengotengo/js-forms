Forms=function(){function e(){throw Error(Array.prototype.slice.call(arguments).join(", "))}function t(){console.log(Array.prototype.slice.call(arguments).join(", "))}function n(e){if(!(e.config[F]&w))return void(e.submit=function(t){e.container.submit(t)});var t=function(){var t=arguments[arguments.length-1],n="function"==typeof t?t:function(){},a=e.config[j]||e.defaults.submitCallback,i=e.config[_]||e.defaults.validateCallback,r=e.config[N]||e.defaults.beforeSubmitCallback,o=e.config[L]||e.defaults.afterSubmitCallback,l=e.config[D]||function(t){t=t||function(){};var n=e.validate();if(i(n),n){var r=e.getFormData();if(e.config[z])for(var o in e.config[z])r[o]=e.config[z][o];return e.defaults.ajax(e.action,"POST",r,function(t){return function(n,i){a.call(e,n,i,t)}}(t)),e.saveChanges(),!0}return!1};r(function(){l(n)&&o()})};e.container.submit=e.submit=t,b(e.container,"submit",function(e){return e.preventDefault&&e.preventDefault(),t(),e.returnValue=!1,!1})}function a(e,t,n,a){var i="";switch(e){case"select":i='<select name="'+t+'" id="'+n+'">';for(var r,o=0;r=a[o];o++)i+=r.input;i+="</select>";break;case"radio":case"checkbox":i='<table cellpadding="0" cellspacing="0" class="forms-'+e+'-table">';for(var r,o=0;r=a[o];o++)i+='<tr><td class="forms-'+e+'">'+r.input+'</td><td class="forms-label-'+e+'">'+r.label+"</td></tr>";i+="</table>";break;default:return!1}return i}function i(e){var t=e.name,n=e.type,a=e.tagName.toLowerCase();if(!t||e.disabled||"reset"==n||"button"==n||("checkbox"==n||"radio"==n)&&!e.checked||("submit"==n||"image"==n)&&e.form&&e.form.clk!=e||"select"==a&&-1==e.selectedIndex)return null;switch(a){case"select":var i=e.selectedIndex;if(0>i)return null;for(var r=[],o=e.options,l="select-one"==n,s=l?i+1:o.length,c=l?i:0;s>c;c++){var u=o[c];if(u.selected){var f=u.value;if(f||(f=u.attributes&&u.attributes.value&&!u.attributes.value.specified?u.text:u.value),l)return f;r.push(f)}}return r;case"input":switch(n){case"radio":return""===e.value?null:e.value;case"checkbox":return e.hasAttribute("value")?""===e.value?1:e.value:1;case"text":case"password":case"hidden":return""===e.value?null:e.value}break;case"textarea":return""===e.value?null:e.value;default:return null}}function r(e,t){var n={};if(!e.length)return n;for(var a,r=0;a=e[r];r++){var o=a.name;if(o&&!a.disabled&&!u(a,"default-text")){var l=i(a);t&&void 0===dt.get(o,n)&&null===l&&dt.set(o,null,n),null!==l&&(t||""!==l&&null!==l&&void 0!==l)&&(a.hasAttribute("bitmask")?(l=parseInt(l,10)||0,(0!==l||t)&&(n[o]|=l)):dt.set(o,l,n))}}return n}function o(e,t){if(e){var n=function(e,t){var n=e.tagName.toLowerCase();switch(n){case"select":for(var a,i=e.children,r=!1,o=0;a=i[o];o++)t!=a.value?(a.removeAttribute("selected"),a.selected=!1):(a.setAttribute("selected","1"),a.selected=!0,r=o);e.selectedIndex=r===!1?-1:r;break;case"input":switch(e.type){case"radio":t==e.value?(e.setAttribute("checked","true"),e.checked=!0):(e.removeAttribute("checked"),e.checked=!1);break;case"password":case"hidden":case"text":"object"==typeof t?(e.setAttribute("value",t),e.value=t):(e.setAttribute("value",t),e.value=t);break;case"checkbox":var l=e.hasAttribute("bitmask");l&&e.value&t||t&&"0"!==t&&"!1"!==t&&!l?(e.setAttribute("checked","true"),e.checked=!0):(e.removeAttribute("checked"),e.checked=!1)}break;case"textarea":e.innerHTML=t,e.value=t}};if("object"==typeof t&&e.length)for(var a,i=0;a=e[i];i++)n(a,null!==t&&t[i]?t[i]:null);else if(!e.length||e.tagName)n(e,t);else for(var a,i=0;a=e[i];i++)n(a,t)}}function l(e,t){if(void 0!==e){var n;if(document.createEvent){if(n=document.createEvent("MouseEvents"),n.initEvent(t,!0,!1),e.length&&void 0==e.name){for(var a=0;a<e.length;a++)e[a].dispatchEvent(n);return}e.dispatchEvent(n)}else if(document.createEventObject){if(n=document.createEventObject(),void 0===e.fireEvent||"function"!=typeof e.fireEvent)return;e.fireEvent("on"+t,n)}}}function s(e){return ft[e]?ft[e]:!1}function c(e,t){u(e,t)||(e.className=(e.className+" "+t).trim())}function u(e,t){return RegExp("( |^)"+t+"( |$)","g").test(e.className)}function f(e,t){var n=RegExp("( |^)"+t+"( |$)","g");e.className=e.className.replace(n,function(e,t,n){return t==n?n:""})}function d(e){var t=!this.elements;t&&(this.elements={});for(var n,a=0;n=this.container[a];a++)t&&(this.elements[n.name]?"[object Array]"===Object.prototype.toString.call(this.elements[n.name])?this.elements[n.name].push(n):this.elements[n.name]=Array.prototype.concat(this.elements[n.name],n):this.elements[n.name]=n),e(n)}function v(){d.call(this,function(e){this.setField(e.name,"")}.bind(this))}function h(e,t,n){var a=document.createElement(n.toUpperCase());return a.setAttribute("class","form_"+t+"_"+e),a.setAttribute("name",e),a}function g(e,t){var n=document.createElement("SPAN");return n.className=e,c(n,t),n}function m(e,t,n){var a=this.notificationContainers[e];if(void 0===a[t]){var i=p(this.container,t,e);if(!i){if(!this.fieldContainers[t])return;i=h(t,e,this.fieldContainers[t].tagName),this.fieldContainers[t].parentNode.insertBefore(i,this.fieldContainers[t].nextSibling)}i.children.length||i.appendChild(g(n,this.options.defaults.hideClass)),a[t]=i}return this.notificationContainers[e][t].children[0]}function b(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),!0):e.attachEvent?e.attachEvent("on"+t,n):(t="on"+t,"function"==typeof e[t]&&(n=function(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}(e[t],n)),e[t]=n,!0)}function p(e,t,n){var a;if(!e.allChildren){e.allChildren={};for(var i,r=e.getElementsByTagName("*"),o=0;i=r[o];o++)e.allChildren[i.className]=e.allChildren[i.className]||[],e.allChildren[i.className].push(i)}return a=e.allChildren["form_"+n+"_"+t],a?a&&void 0===a.length?a:1==a.length?a[0]:a[0]?a:null:null}function C(e,t,n,i){if(i=i||!1,n=n||!1,t){var r=e.container;e.errorContainers={},e.warningContainers={},e.fieldContainers={};var o=function(e,t){var n=document.createElement("LABEL");return n.innerHTML=e,n.setAttribute("for",t),n};for(var l in t){var s=l+"",c=t[s],u=c[U];if(u&&(e.fieldContainers[s]=p(r,s,Y),e.fieldContainers[s])){e.fieldContainers[s].innerHTML="",v=n?s+"-"+ct++:s;var f=p(r,s,Q);if(c.label&&f){f.innerHTML="";var d=o(c.label,v);i&&d.setAttribute("title",s),f.appendChild(d)}var v,h={};c.data?h=c.data:c.label?h[c.label]=null:h[""]=null,e.fieldContainers[s].innerHTML=function(e,t,n,i,r){var o=[],l=1,s=0;for(var c in e)s++;var u=s>=2;for(var f in e){var d,v=t+(u?"-"+l:""),h={},g=null===e[f]?"":e[f];"select"==n?(0!==c&&(d='<option value=""></option>',o.push({input:d}),c=0),d='<option value="'+g+'">'+f+"</option>"):(d="text"==n||"hidden"==n||"password"==n||"checkbox"==n||"radio"==n?'<input type="'+n+'" name="'+i+'" id="'+v+'" error-id="'+t+'" value="'+g+'" />':'<textarea name="'+i+'" id="'+v+'" error-id="'+t+'" >'+g+"</textarea>",h.label=r?"":'<label for="'+v+'">'+f+"</label>"),h.input=d,o.push(h),l++}var m=a(n,i,t,o);return m?m:o[0].input}(h,v,u,s,!!f)}}}}function y(a){function i(a){function i(e){return!!e}var s={cache:null,formDataCache:null,config:null,defaults:u,initialized:!1,container:null},f=this;if(s.config=s.config||a,f.init=function(n){return s.initialized?(t(et),!1):(i(n)||e(J),s.config=n,s.initialized=!0,!0)},f.isChanged=!1,f.currentData={},f.initialData={},f.differsObj={},f.prevValues={},f.valuesCache={},f.lastChangedStatus=!1,f.config=s.config,f.options=s,f.defaults=u,!i(s.config))return void t(J);if(s.config[x]&&(s.container=document.getElementById(s.config[x]),s.container||e(tt,s.config[x]),f.container=s.container),s.config[O]&&(f.container=s.container=s.config[O],s.config[x]=f.container.getAttribute("id")),f.container){s.config[F]=s.config[F]?s.config[F]|u.flags:u.flags,s.config[I]||(s.config[I]=u.validationType),console.log("opt.config[PARAM_FLAGS]",s.config[F]);var g=!!(s.config[F]&E);f.getFormData=function(){return f.currentData},s.config[B]&&s.container.setAttribute(B,s.config[B]),f.action=s.container.getAttribute("action"),f.setFieldValue=function(e,t,n){n=n||!1},f.setFieldValues=function(e,t){t=t||!1},f.setField=function(e,t){f.elements[e]&&(o(f.elements[e],t),l(f.elements[e],"formChange"))},f.setFields=function(e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&f.elements[t]&&(o(f.elements[t],e[t]),l(f.elements[t],"formChange"));f.getFormData(!0)},f.getField=function(e){return f.elements[e]},f.validate=function(e){if(e){var t=f.getFormData(!0);return h.field(f,e,f.config[S][e],t[e],u.errorClass,u.warningClass)}return f.config[R]?f.config[R](f,f.getFormData(1)):h.process(f,s.config[S])},f.clear=v.bind(f),f.notificationContainers={},f.notificationContainers[K]={},f.notificationContainers[Z]={},f.getErrorContainer=function(e){return m.call(f,K,e,u.errorClass)},f.getWarningContainer=function(e){return m.call(f,Z,e,u.warningClass)},f.initInputs=function(){var e=s.config[S]||{},t=s.config[P],n=s.config[I],a=this.config[M]||u.onChange,i=this.config[T]||function(){console.log("fieldChange fired",arguments)},r=function(e,t,n){var r=dt.get(t,this.currentData),o=f.getFieldValue(t),l=dt.get(t,this.initialData);switch(n){case at:"blur"==e.type&&this.validate(t);break;case it:this.validate(t);break;case nt:}differs(r,o)&&(dt.set(t,o,this.currentData),i(t,o));var s=differs(this.differsObj,{});differs(l,o)?dt.set(t,!0,this.differsObj):dt.del(t,this.differsObj);var c=differs(this.differsObj,{});s!=c&&(this.isChanged=c,a(c,this)),console.log(o,l)};d.call(f,function(a){void 0===a.hasAttribute&&(a.hasAttribute=function(e){return void 0!==this[e]}),function(){(!a.type||"hidden"!=a.type&&"disabled"!=a.type)&&(a.setAttribute("tabindex",++st),a.formIndex=a.formIndex||st)}();var i=a.name,l=dt.get(i,t);if(e[i]){void 0===l&&(l=void 0!==e[i].defaultVal?e[i].defaultVal:null);for(var s in e[i]){var u=null;switch(s){case $:case W:if(a.length)for(var d,v=0;d=a[v];v++)d.setAttribute(s,"1");else a.setAttribute(s,"1");break;case H:u=e[i][s];for(var h in u)a.setAttribute(h,u[h]);break;case G:if(u=e[i][s],"string"==typeof u)c(a,u);else try{for(var v=0;v<u.length;v++)c(a,u[v])}catch(g){}}}}if(void 0!==l&&(o(a,l),dt.set(i,l,f.currentData)),!a.initialized){var m=function(e){return function(t){r.call(this,t,e,n)}.bind(this)}.call(f,a.name);b(a,"blur",m),b(a,"click",m),b(a,"keyup",m),b(a,"formChange",m),a.initialized=!0}})},f.saveChanges=function(){f.differsObj={},f.initialData=cloneObject(f.currentData),(s.config[M]||u.onChange)(!1,f),f.isChanged=!1},f.resetToDefaults=function(){var e=s.config[S]||{};d.call(f,function(t){e[t.name]&&void 0!==e[t.name].defaultVal&&(o(t,e[t.name].defaultVal),dt.set(t.name,e[t.name].defaultVal,f.prevValues))})},f.currentData=r(f.container,!!(s.config[F]&E)),console.log("initial form data",f.currentData),C(f,s.config[S],!!(s.config[F]&A),!!(s.config[F]&k)),f.getFieldValue=function(e){return f.elements[e]?dt.get(e,r(Array.prototype.concat(f.elements[e]),g)):void 0},console.log("initInputs"),f.initInputs(),s.config[V]&&s.config[V](f),console.log("binding Form submit event",f.currentData),n(f),console.log("saveChanges"),f.saveChanges(),s.config[I]===it&&(console.log("form.validate"),f.validate()),f.remove=function(){Forms.remove(s.config[x])},f.remove(),ut[s.config[x]]=f}}var u={flags:a.flags||0,validationType:a.validationType||Forms.VALIDATION_ON_SUBMIT,hideClass:a.hideClass||"h",errorClass:a.errorClass||"error",warningClass:a.warningClass||"warning",ajax:a.ajax||function(e,t,n,a,i){var r=new XMLHttpRequest;i=i||function(){},r.open(t,e),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.send(dt.serialize(n,null)),r.onreadystatechange=function(){200==r.status&&4==r.readyState&&a(r.status,r.response),200!=r.status&&i()}},onChange:a.onChange||function(){},formContext:a.formContext||function(){},fieldContext:a.fieldContext||function(){},submitCallback:a.submitCallback||function(e,t,n){return n(),!0},validateCallback:a.validateCallback||function(){return!0},beforeSubmitCallback:a.beforeSubmitCallback||function(e){return e(),!0},afterSubmitCallback:a.afterSubmitCallback||function(){return!0}},h={methods:{},hideError:function(e){e&&c(e,u.hideClass)},showError:function(e,t){e&&(e.innerHTML=t,f(e,u.hideClass))},field:function(e,t,n,a,i,r){var o=!0,l=!0;if(!n)return l;if(n[q])for(var u in n[q])if(Object.prototype.hasOwnProperty.call(n[q],u)){var d=h.methods[u]||s(u);if(d){if(("required"==u||""!=a&&null!==a&&void 0!==a)&&(o=d[rt](a,n[q][u])),!o){h.showError(e.getErrorContainer(t),d[ot].supplant({val:n[q][u]})),e.elements[t]&&void 0!==e.elements[t].name&&c(e.elements[t],i),l=!1,console.log(t,"is not valid");break}e.notificationContainers[K][t]&&h.hideError(e.getErrorContainer(t)),e.elements[t]&&void 0!==e.elements[t].name&&f(e.elements[t],i)}}if(n[X])for(var u in n[X])if(Object.prototype.hasOwnProperty.call(n[X],u)){var d=h.methods[u]||s(u);if(d)if(l){if(("required"==u||""!=a&&null!==a&&void 0!==a)&&(o=d[rt](a,n[X][u])),!o){h.showError(e.getWarningContainer(t),d[lt].supplant({val:n[X][u]})),e.elements[t]&&void 0!==e.elements[t].name&&c(e.elements[t],r);break}e.notificationContainers[Z][t]&&h.hideError(e.getWarningContainer(t)),e.elements[t]&&void 0!==e.elements[t].name&&f(e.elements[t],r)}else e.notificationContainers[Z][t]&&h.hideError(e.getWarningContainer(t))}return l},process:function(e,t){var n=e.getFormData(1),a=!0;for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i][q]||t[i][X])&&(h.field(e,i,t[i],n[i],u.errorClass,u.warningClass)||(a=!1));return a}};if(a.validation)for(var g in a.validation)Object.prototype.hasOwnProperty.call(a.validation,g)&&(h.methods[g]=a.validation[g]);this.create=i}var A=1,k=2,E=4,w=8,x="id",O="obj",F="flags",D="onSubmit",N="beforeSubmit",j="submitCallback",L="afterSubmit",S="fields",I="validationType",T="onFieldChange",M="onChange",V="onInit",_="onValidate",R="validate",P="data",z="params",B="action",H="attributes",U="type",q="validate",G="class",W="bitmask",$="disabled",X="warning",Y="field",Z="warning",K="error",Q="label",J="No configuration passed",et="Form is initialized already",tt="No such element on the page",nt=1,at=2,it=3,rt=2,ot=0,lt=1,st=0,ct=1,ut={},ft={multiple:["Must be a multiple of {val}","Should be a multiple of {val}",function(e,t){return e%t===0}],email:["Wrong email format","Bad email format",function(e){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}],"int":["Must be an integer","Should be an integer",function(e){return parseInt(e,10)==e}],"float":["Must be a decimal","Should be a decimal",function(e){return/^-?\d{0,}([\.|\,]\d{0,})?$/.test(e)}],min:["Must be >= {val}","Value is lower than {val}",function(e,t){return(parseFloat(e)||0)>=(parseFloat(t)||0)}],max:["Must be <= {val}","Value is higher than {val}",function(e,t){return(parseFloat(e)||0)<=(parseFloat(t)||0)}],date:["Wrong date format","Bad date format",function(e){return/^([1-9]|0[1-9]|1[012])[- \/.](0[1-9]|[1-9]|[12][0-9]|3[01])[- \/.](19|20)\d\d$/.test(e)}],length:["Must be {val} characters long","Should be {val} characters long",function(e,t){return e.length==t}],maxLength:["Must be <= {val} characters long","Should be less than {val} characters long",function(e,t){return e.length<=t}],minLength:["Must be >= {val} characters long","Should be more than {val} characters long",function(e,t){return e.length<=t}],required:["Required field","This field is highly recommended to fill",function(e){return!(""==e||null==e||void 0===e)}]},dt={allReg:/\[([a-zA-Z0-9-]*)\]/g,isObjReg:/\[(.*)\]/g,getPath:function(e){var t=e.replace(dt.isObjReg,""),n=[];t&&n.push(t);for(var a;a=dt.allReg.exec(e);)n.push(a[1]);return n},serialize:function(e,t){var n=[];for(var a in e){var i=t?t+"["+a+"]":a,r=e[a];n.push("object"==typeof r&&null!==r?dt.serialize(r,i):encodeURIComponent(i)+"="+(null===r?"":encodeURIComponent(r)))}return n.join("&")},getOrDel:function(e,t,n){var a=this.getPath(e);if(void 0===t||void 0===t[a[0]])return void 0;for(var i,r,o=t,l=0;l<a.length;l++)if(void 0!==o[a[l]]){if(""==o[a[l]])return n?delete o[a[l]]:o[a[l]];i=o,r=a[l],o=o[a[l]]}return n?delete i[r]:o},del:function(e,t){return this.getOrDel(e,t,!0)},get:function(e,t){return this.getOrDel(e,t)},setVal:function(e,t,n){if(e.length){var a=e.shift(),i=e[0],r=n;if(void 0===i){if(""==a)return n.push?void n.push(t):!1;if(void 0===n)return;return void(n[a]=t)}""==a&&(r.push||(r=[]),r.push(""==i?[]:{}),a=r.length-1),r=r[a]="object"==typeof r[a]&&null!==r[a]?r[a]:""==i?[]:{},dt.setVal(e,t,r)}},set:function(e,t,n){var a=this.getPath(e);dt.setVal(a,t,n)}};return function(e,t){void 0!==window.Element&&(e[t]||(e[t]=function(e){return this.querySelectorAll("."+e)},Element.prototype[t]=e[t]))}(document,"getElementsByClassName"),{Form:y,remove:function(e){ut[e]&&delete ut[e]},getList:function(){return ut},VALIDATION_ON_SUBMIT:nt,VALIDATION_ON_CHANGE:at,VALIDATION_ON_KEYUP:it,FLAG_DEBUG:k,FLAG_SUBMIT_EMPTY:E,FLAG_UNIQUE_LABELS:A,FLAG_ASYNC:w}}();