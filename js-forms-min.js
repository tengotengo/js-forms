Forms=function(){function rb(){throw new Error(Array[L].slice.call(arguments).join(", "))}function sb(a,b){for(var c in a)if(Object[L][M].call(a,c)&&b(c,a[c])===!1)break}function tb(){console.log(Array[L].slice.call(arguments).join(", "))}function ub(a,b,c){var d=qb.get(b,this[A]),e=this.getFieldValue(b),f=qb.get(b,this[B]),g=this[D][s]||this[I][s],h=this[D][r]||!1;if(differs(d,e,!0)){switch(qb.set(b,e,this[A]),c){case gb:case hb:this[w](b);break;case fb:}h&&h(b,e,this)}var i=differs(this[C],{});differs(f,e,!0)?qb.set(b,!0,this[C]):qb.del(b,this[C]);var j=differs(this[C],{});i!=j&&(this[N]=j,g(j,this))}function vb(a,b){var c=b.name,d=a[D][q];if(void 0===b.hasAttribute&&(b.hasAttribute=function(a){return"undefined"!=typeof this[a]}),function(){(!b.type||"hidden"!=b.type&&"disabled"!=b.type)&&(b.setAttribute("tabindex",++lb),b.formIndex=b.formIndex||lb)}(),a[D][p][c]&&sb(a[D][p][c],function(a,c){var d=null;switch(a){case Y:case X:if(b[O])for(var f,e=0;f=b[e];e++)f.setAttribute(a,"1");else b.setAttribute(a,"1");break;case Q:d=c,sb(d,function(a,c){b.setAttribute(a,c)});break;case W:if(d=c,"string"==typeof d)Fb(b,d);else try{for(var e=0;e<d[O];e++)Fb(b,d[e])}catch(g){}}}),!b[K]){var e=function(a){return function(b){ub.call(this,b,a,d)}.bind(this)}.call(a,b.name);Mb(b,"blur",e),Mb(b,"click",e),Mb(b,"keyup",e),Mb(b,"contextmenu",function(c){a[I][n](c,b,a)}),b[K]=!0}}function wb(a){if(!(a[D][e]&b))return a.submit=function(b){a[E].submit(b)},void 0;var c=function(){var b=arguments[arguments[O]-1],c="function"==typeof b?b:function(){},d=a[D][j]||a[I][j],e=a[D][u]||a[I][u],k=a[D][h]||a[I][h],l=a[D][i]||a[I][i],m=a[D][g]||function(b){b=b||function(){},a[D][H]&&sb(a[D][H],function(b,c){qb.set(b,c,a[A])}),a[I][f](a.action,"POST",a[A],function(b){return function(c,e){c&&a.saveChanges(),d.call(a,c,e,b)}}(b))};k(function(){var b=a.getAllValues();a[A]=b;var d=a[w]();e(d,function(){m(c),l()})})};a[E].submit=a.submit=c,Mb(a[E],"submit",function(a){return a.preventDefault&&a.preventDefault(),c(),a.returnValue=!1,!1}),Mb(a[E],"contextmenu",function(b){a[I][o](b,a)})}function xb(a,b,c,d){var e="";switch(a){case"select":e='<select name="'+b+'" id="'+c+'">';for(var g,f=0;g=d[f];f++)e+=g.input;e+="</select>";break;case"radio":case"checkbox":e='<table cellpadding="0" cellspacing="0" class="forms-'+a+'-table">';for(var g,f=0;g=d[f];f++)e+='<tr><td class="forms-'+a+'">'+g.input+"</td>"+'<td class="forms-label-'+a+'">'+g.label+"</td>"+"</tr>";e+="</table>";break;default:return!1}return e}function yb(a){var b=a.name,c=a.type,d=a.tagName.toLowerCase();if(!b||a.disabled||"reset"==c||"button"==c||"radio"==c&&!a.checked||("submit"==c||"image"==c)&&a.form&&a.form.clk!=a||"select"==d&&-1==a.selectedIndex)return null;switch(d){case"select":var e=a.selectedIndex;if(0>e)return ob.select;for(var f=[],g=a.options,h="select-one"==c,i=h?e+1:g[O],j=h?e:0;i>j;j++){var k=g[j];if(k.selected){var l=k.value;if(void 0===l&&(l=k.attributes&&k.attributes.value&&!k.attributes.value.specified?k.text:k.value),h)return void 0===l||""===l||null===l?ob.select:l;f.push(l)}}return f.join(",");case"input":switch(c){case"radio":return""===a.value?ob.radio:a.value;case"checkbox":return a.checked?a.value||"1":ob.checkbox;case"text":case"password":case"hidden":return a.value}break;case"textarea":return a.value;default:return null}}function zb(a){var b={};if(!a[O])return b;for(var d,c=0;d=a[c];c++){var e=d.name;if(e&&!d.disabled&&!Gb(d,"default-text")){var f=yb(d),g=qb.get(e,b);void 0===g&&null===f&&qb.set(e,null,b),null!==f&&(d.hasAttribute("bitmask")&&(f=parseInt(f,10)||0,f|=parseInt(g,10)||0),qb.set(e,f,b))}}return b}function Ab(a,b){if(!a)return!1;var c=function(a,b){switch(a.tagName.toLowerCase()){case"select":for(var f,c=a.children,d=!1,e=0;f=c[e];e++)b!=f.value?(f.removeAttribute("selected"),f.selected=!1):(f.setAttribute("selected","1"),f.selected=!0,d=e);return d===!1?(a.selectedIndex=-1,!1):(a.selectedIndex=d,!0);case"input":switch(a.type){case"radio":return b==a.value?(a.setAttribute("checked","true"),a.checked=!0,!0):(a.removeAttribute("checked"),a.checked=!1,!1);case"password":case"hidden":case"text":return a.setAttribute("value",null===b?"":b),a.value=null===b?"":b,!0;case"checkbox":var g=a.hasAttribute("bitmask");return g&&a.value&b||b&&"0"!==b&&"!1"!==b&&!g?(a.setAttribute("checked","true"),a.checked=!0):(a.removeAttribute("checked"),a.checked=!1),!0}break;case"textarea":return a[J]=b,a.value=b,!0}},d=!1;if("object"==typeof b&&a[O]&&null!==b){for(var f,e=0;f=a[e];e++)c(f,b)&&(d=!0);return d}if(a[O]&&!a.tagName){for(var f,e=0;f=a[e];e++)c(f,b)&&(d=!0);return d}return c(a,b)}function Bb(a){return"[object Array]"===Object[L].toString.call(a)}function Cb(a,b,c){if(a[F][b]){var d=Ab(a[F][b],c),e=Bb(a[F][b])?a[F][b][0]:a[F][b];d||(c=ob[(e.type||e.tagName).toLowerCase()]),Ib(e)||qb.set(b,c,a[A])}}function Db(a,b){return a[F][b]?qb.get(b,zb(Array[L].concat(a[F][b]))):void 0}function Eb(a){return pb[a]?pb[a]:!1}function Fb(a,b){Gb(a,b)||(a.className=(a.className+" "+b).trim())}function Gb(a,b){return new RegExp("( |^)"+b+"( |$)","g").test(a.className)}function Hb(a,b){var c=new RegExp("( |^)"+b+"( |$)","g");a.className=a.className.replace(c,function(a,b,c){return b==c?c:""})}function Ib(a){return!!(a.type&&"disabled"==a.type||a.disabled||a.getAttribute("disabled"))}function Jb(a,b,c){var d=document.createElement(c.toUpperCase());return d.setAttribute("class","form_"+b+"_"+a),d.setAttribute("name",a),d}function Kb(a,b){var c=document.createElement("SPAN");return c.className=a,Fb(c,b),c}function Lb(a,b,c){var d=this.notificationContainers[a];if(void 0===d[b]){var e=Nb(this[E],b,a);if(!e){if(!this[G][b])return;e=Jb(b,a,this[G][b].tagName),this[G][b].parentNode.insertBefore(e,this[G][b].nextSibling)}e.children[O]||e.appendChild(Kb(c,this.options[I][k])),d[b]=e}return this.notificationContainers[a][b].children[0]}function Mb(a,b,c){return a.addEventListener?(a.addEventListener(b,c,!1),!0):a.attachEvent?a.attachEvent("on"+b,c):(b="on"+b,"function"==typeof a[b]&&(c=function(a,b){return function(){a.apply(this,arguments),b.apply(this,arguments)}}(a[b],c)),a[b]=c,!0)}function Nb(a,b,c){var d;if(!a.allChildren){a.allChildren={};for(var g,e=a.getElementsByTagName("*"),f=0;g=e[f];f++)a.allChildren[g.className]=a.allChildren[g.className]||[],a.allChildren[g.className].push(g)}return d=a.allChildren["form_"+c+"_"+b],d?d&&void 0===d[O]?d:1==d[O]?d[0]:d[0]?d:null:null}function Ob(a,b,c){c=c||!1,sb(a[F],function(d,e){var f=function(e,f){var g=a[D][p],h=qb.get(d,b),i=g[d]?!!g[d][U]:!1,j=ob[(f.type||f.tagName).toLowerCase()],k=!1,l=void 0!==h;if(void 0===h&&(k=!0,h=j,g[d]&&(void 0!==g[d][V]?(h=g[d][V],k=!1):g[d][T]&&i&&sb(g[d][T],function(a,b){return h=b,k=!1,!1}))),!(k&&Ib(f)||!l&&void 0!==qb.get(d,a[A]))){var m=Ab(e,h);m||(h=j),Ib(f)||(c&&ub.call(a,null,d,a[D][q]),l&&h!==j||qb.set(d,h,a[z]),qb.set(d,h,a[A]))}};if(Bb(e)){for(var h,g=0;h=e[g];g++)vb(a,h);f(e,e[0])}else vb(a,e),f(e,e)})}function Pb(a,b,c){if(c=c||!1,b){var d=a[E];a[G]={};var e=function(a,b){var c=document.createElement("LABEL");return c[J]=a,c.setAttribute("for",b),c};sb(b,function(b,f){var g=f[R];if(g&&(a[G][b]=Nb(d,b,$),a[G][b])){a[G][b][J]="",j=b+"-"+mb++;var h=Nb(d,b,bb);if(f.label&&h){h[J]="";var i=e(f.label,j);c&&i.setAttribute("title",b),h.appendChild(i)}var j,k={};f.data?k=f.data:f.label?k[f.label]=null:k[""]=null,a[G][b][J]=function(a,b,c,d,e){var f=[],g=1,h=0;sb(a,function(){h++});var i=h>=2;sb(a,function(a,h){var k,j=b+(i?"-"+g:""),l={},m=null===h?"":h;"select"==c?k='<option value="'+m+'">'+a+"</option>":(k="text"==c||"hidden"==c||"password"==c||"checkbox"==c||"radio"==c?'<input type="'+c+'" name="'+d+'" id="'+j+'" error-id="'+b+'" value="'+m+'" />':'<textarea name="'+d+'" id="'+j+'" error-id="'+b+'" >'+m+"</textarea>",l.label=e?"":'<label for="'+j+'">'+a+"</label>"),l.input=k,f.push(l),g++});var j=xb(c,d,b,f);return j?j:f[0].input}(k,j,g,b,!!h)}})}}function Qb(b){function H(b){function i(a){return!!a}var f={},h=this;if(f[K]=!1,f[I]=g,f[E]=null,f[D]=b||null,h.init=function(a){return f[K]?(tb(db),!1):(i(a)||rb(cb),f[D]=a,f[K]=!0,!0)},h[N]=!1,h[z]={},h[A]={},h[B]={},h[C]={},h[D]=f[D],h.options=f,h[I]=g,!i(f[D]))return tb(cb),void 0;if(f[D][c]&&(f[E]=document.getElementById(f[D][c]),f[E]||rb(eb,f[D][c]),h[E]=f[E]),f[D][d]&&(h[E]=f[E]=f[D][d],f[D][c]=h[E].getAttribute("id")),!h[E])return tb(eb),void 0;f[D][e]=f[D][e]?f[D][e]|g[e]:g[e],f[D][q]||(f[D][q]=g[q]),h.getFormData=function(){return h[A]},f[D][P]&&f[E].setAttribute(P,f[D][P]),h.action=f[E].getAttribute("action");var j=f[D][r]||!1;h.resetToDefaults=function(){Ob(h,h[z])},h.changeField=function(a,b){var c={};qb.set(a,b,c),Ob(h,c,!0)},h.changeFormData=function(a){Ob(h,a,!0)},h.setField=function(a,b){Cb(h,a,b)},h.setFormData=function(a){Ob(h,a)},h.clearForm=function(a){a=a||!1,sb(h[F],function(b,c){var d=null,e=Ab(c,d);e||(d=ob[(c.type||c.tagName).toLowerCase()]),qb.set(b,d,h[A]),a&&ub.call(h,null,b,h[D][q])})},h.fireOnFieldChangeCallbacks=function(){sb(h[F],function(a){j(a,qb.get(a,h[A]),h)})},h.resetValidation=function(){G.reset(h)},h.getFieldValue=function(a){return Db(h,a)},h.getField=function(a){return h[F][a]},h[w]=function(a){return a?G.field(h,a,h[D][p][a],qb.get(a,h[A]),g[l],g[m]):h[D][w]?h[D][w](h,h[A]):G.process(h)},h.notificationContainers={},h.notificationContainers[ab]={},h.notificationContainers[_]={},h.getErrorContainer=function(a){return Lb.call(h,ab,a,g[l])},h.getWarningContainer=function(a){return Lb.call(h,_,a,g[m])},h.saveChanges=function(){h[C]={},h[B]=cloneObject(h[A]),(f[D][s]||g[s])(!1,h),h[N]=!1},h.getAllValues=function(){return zb(h[E])},h[A]=zb(h[E]),h[z]=cloneObject(h[A]),Pb(h,f[D][p],!!(f[D][e]&a)),h[F]={};for(var n,k=0;n=h[E][k];k++)h[F][n.name]?Bb(h[F][n.name])?h[F][n.name].push(n):h[F][n.name]=Array[L].concat(h[F][n.name],n):h[F][n.name]=n;Ob(h,h[D][y]),f[D][t]&&f[D][t](h),wb(h),h.saveChanges(),f[D][q]===hb&&h[w](),h.remove=function(){Forms.remove(f[D][c])},h.remove(),nb[f[D][c]]=h}var g={};g[e]=b[e]||0,g[q]=b[q]||Forms.VALIDATION_ON_SUBMIT,g[k]=b[k]||"h",g[l]=b[l]||"error",g[f]=b[f]||function(a,b,c,d,e){var f=new XMLHttpRequest;e=e||function(){},f.open(b,a),f.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),f.setRequestHeader("X-Requested-With","XMLHttpRequest"),f.send(qb.serialize(c,null)),f.onreadystatechange=function(){200==f.status&&4==f.readyState&&d(!0,f.response),200!=f.status&&e()}},g[s]=b[s]||function(){},g[o]=b[o]||function(){},g[n]=b[n]||function(){},g[m]=b[m]||"warning",g[u]=b[u]||function(a,b){var c=!0;sb(a,function(a,b){1!=b&&(c=!1)}),c&&b()},g[v]=b[v]||function(){return!0},g[i]=b[i]||function(){return!0},g[h]=b[h]||function(a){return a(),!0},g[j]=b[j]||function(a,b,c){return c(),!0};var G={methods:{},hideError:function(a){a&&Fb(a,g[k])},showError:function(a,b){a&&(a[J]=b,Hb(a,g[k]))},field:function(a,b,c,d,e,f){var g=!0,h=!0;return c?(c[S]&&(a.notificationContainers[ab][b]&&G.hideError(a.getErrorContainer(b)),a[F][b]&&void 0!==a[F][b].name&&Hb(a[F][b],e),sb(c[S],function(c,f){var i=G.methods[c]||Eb(c);if(i)return("required"==c||""!=d&&null!==d&&"undefined"!=typeof d)&&(g=i[ib](d,f)),g?void 0:(G.showError(a.getErrorContainer(b),i[jb].supplant({val:f})),a[F][b]&&void 0!==a[F][b].name&&Fb(a[F][b],e),h=!1,!1)})),c[Z]&&(a.notificationContainers[_][b]&&G.hideError(a.getWarningContainer(b)),a[F][b]&&void 0!==a[F][b].name&&Hb(a[F][b],f),sb(c[Z],function(c,e){var i=G.methods[c]||Eb(c);if(i)return h?(("required"==c||""!=d&&null!==d&&"undefined"!=typeof d)&&(g=i[ib](d,e)),g?void 0:(G.showError(a.getWarningContainer(b),i[kb].supplant({val:e})),a[F][b]&&void 0!==a[F][b].name&&Fb(a[F][b],f),h="warning",!1)):(a.notificationContainers[_][b]&&G.hideError(a.getWarningContainer(b)),void 0)})),h):h},reset:function(a){var b=a[D][p];sb(b,function(b,c){c[S]&&(a.notificationContainers[ab][b]&&G.hideError(a.getErrorContainer(b)),a[F][b]&&void 0!==a[F][b].name&&Hb(a[F][b],g[l])),c[Z]&&(a.notificationContainers[_][b]&&G.hideError(a.getWarningContainer(b)),a[F][b]&&void 0!==a[F][b].name&&Hb(a[F][b],g[m]))})},process:function(a){var b={},c=a[D][p];return sb(c,function(c,d){(d[S]||d[Z])&&(b[c]=G.field(a,c,d,qb.get(c,a[A]),g[l],g[m]))}),b}};b[x]&&sb(b[x],function(a,b){G.methods[a]=b}),this.create=H}var a=2,b=8,c="id",d="obj",e="flags",f="ajax",g="onSubmit",h="beforeSubmit",i="afterSubmit",j="submitCallback",k="hideClass",l="errorClass",m="warningClass",n="fieldContext",o="formContext",p="fields",q="validationType",r="onFieldChange",s="onChange",t="onInit",u="onValidate",v="onWarning",w="validate",x="validation",y="data",z="defaultData",A="currentData",B="initialData",C="differsObj",D="config",E="container",F="elements",G="fieldContainers",H="params",I="defaults",J="innerHTML",K="initialized",L="prototype",M="hasOwnProperty",N="isChanged",O="length",P="action",Q="attributes",R="type",S="validate",T="data",U="notEmpty",V="defaultVal",W="class",X="bitmask",Y="disabled",Z="warning",$="field",_="warning",ab="error",bb="label",cb="No configuration passed",db="Form is initialized already",eb="No such element on the page",fb=1,gb=2,hb=3,ib=2,jb=0,kb=1,lb=0,mb=1,nb={},ob={select:null,"select-one":null,text:"",textarea:"",radio:null,checkbox:null},pb={multiple:["Must be a multiple of {val}","Should be a multiple of {val}",function(a,b){return 0===a%b}],email:["Wrong email format","Bad email format",function(a){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(a)}],"int":["Must be an integer","Should be an integer",function(a){return parseInt(a,10)==a}],"float":["Must be a decimal","Should be a decimal",function(a){return/^-?\d{0,}([\.|\,]\d{0,})?$/.test(a)}],min:["Must be >= {val}","Value is lower than {val}",function(a,b){return(parseFloat(a)||0)>=(parseFloat(b)||0)}],max:["Must be <= {val}","Value is higher than {val}",function(a,b){return(parseFloat(a)||0)<=(parseFloat(b)||0)}],date:["Wrong date format","Bad date format",function(a){return/^([1-9]|0[1-9]|1[012])[- \/.](0[1-9]|[1-9]|[12][0-9]|3[01])[- \/.](19|20)\d\d$/.test(a)}],length:["Must be {val} characters long","Should be {val} characters long",function(a,b){return a[O]==b}],maxLength:["Must be <= {val} characters long","Should be less than {val} characters long",function(a,b){return a[O]<=b}],minLength:["Must be >= {val} characters long","Should be more than {val} characters long",function(a,b){return a[O]<=b}],required:["Required field","This field should be filled",function(a){return!(""==a||null==a||"undefined"==typeof a)}]},qb={allReg:/\[([a-zA-Z0-9-]*)\]/g,isObjReg:/\[(.*)\]/g,getPath:function(a){var b=a.replace(qb.isObjReg,""),c=[];b&&c.push(b);for(var d;d=qb.allReg.exec(a);)c.push(d[1]);return c},serialize:function(a,b){var c=[];for(var d in a){var e=b?b+"["+d+"]":d,f=a[d];c.push("object"==typeof f&&null!==f?qb.serialize(f,e):encodeURIComponent(e)+"="+(null===f?"":encodeURIComponent(f)))}return c.join("&")},getOrDel:function(a,b,c){var d=this.getPath(a);if(void 0===b||void 0===b[d[0]])return void 0;for(var f,g,e=b,h=0;h<d[O];h++)if(void 0!==e[d[h]]){if(""==e[d[h]])return c?delete e[d[h]]:e[d[h]];f=e,g=d[h],e=e[d[h]]}return c?delete f[g]:e},del:function(a,b){return this.getOrDel(a,b,!0)},get:function(a,b){return this.getOrDel(a,b)},setVal:function(a,b,c){if(a[O]){var d=a.shift(),e=a[0],f=c;if(void 0===e){if(""==d)return c.push?(c.push(b),void 0):!1;if(void 0===c)return;return c[d]=b,void 0}""==d&&(f.push||(f=[]),f.push(""==e?[]:{}),d=f[O]-1),f=f[d]="object"==typeof f[d]&&null!==f[d]?f[d]:""==e?[]:{},qb.setVal(a,b,f)}},set:function(a,b,c){var d=this.getPath(a);qb.setVal(d,b,c)}};return function(a,b){void 0!==window.Element&&(a[b]||(a[b]=function(a){return this.querySelectorAll("."+a)},Element[L][b]=a[b]))}(document,"getElementsByClassName"),{Form:Qb,remove:function(a){nb[a]&&delete nb[a]},getList:function(){return nb},VALIDATION_ON_SUBMIT:fb,VALIDATION_ON_CHANGE:gb,VALIDATION_ASAP:hb,FLAG_DEBUG:a,FLAG_ASYNC:b}}();